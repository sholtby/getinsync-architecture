# GetInSync NextGen — Session Summary 2026-02-18

**Session Focus:** Technology Health Dashboard Schema Deployment  
**Duration:** Single evening session  
**Phase:** Week 4 work (ahead of schedule — Week 3)

---

## Completed

### Chunk 1a: technology_lifecycle_reference table
- Created global reference table for vendor lifecycle dates
- GENERATED ALWAYS `current_status` column removed (PostgreSQL CURRENT_DATE not immutable)
- Status computed inline in views instead — simpler, always accurate, no cron
- 6 indexes including GIN full-text search for AI lookup
- RLS: anyone reads, platform admins write

### Chunk 1b: vendor_lifecycle_sources table
- Created vendor registry with lifecycle page URLs
- 11 initial vendors seeded (Microsoft, Oracle, VMware, Red Hat, Adobe, SAP, Cisco, IBM, Salesforce, AWS, Google)

### Chunk 1c: Lifecycle seed data
- 5 additional vendors added (HP, SUSE, HCL, Apache, Nginx) — 16 total
- 76 lifecycle reference rows seeded from customer infrastructure analysis
- 9 vendors, 3 product families (Operating System: 38, Database: 17, Web Server: 21)
- All dates sourced from public vendor lifecycle pages
- ON CONFLICT idempotent — safe to re-run

### Chunk 2: ALTER existing tables
- `applications` +3 columns: management_classification (CHECK: apm/alm/other, default 'apm'), csdm_stage (CHECK: stage_0-4, nullable), branch (TEXT, nullable)
- `deployment_profiles` +1 column: server_name (TEXT, nullable, partial index)
- `technology_products` +1 column: lifecycle_reference_id (UUID FK → technology_lifecycle_reference, ON DELETE SET NULL)
- `deployment_profile_technology_products` +2 columns: edition (TEXT), updated_at (TIMESTAMPTZ + trigger)
- `technology_product_categories`: Web Server added to all 17 namespaces (display_order 25)

### Chunk 3: Security (gap fill)
- Added audit triggers to technology_products and deployment_profile_technology_products (pre-existing gaps)
- Added audit triggers to both Chunk 1 tables (missed during execution)
- Added updated_at triggers to both Chunk 1 tables (missed during execution)
- Added RLS + GRANTs + policies to both Chunk 1 tables (missed during execution)
- **Lesson learned:** When running SQL from files, Chunk 1's RLS/GRANT/trigger blocks were not executed. Session-end checklist caught all gaps.

### Chunk 5: Views (4 new, all security_invoker=true)
- `vw_technology_tag_lifecycle_risk` — foundation: per-tag lifecycle data with computed status + days_to_eol
- `vw_technology_health_summary` — aggregate: KPIs by category + lifecycle stage, 12-month risk windows
- `vw_application_infrastructure_report` — flat: DP with OS/DB/Web via LATERAL joins + derived crown_jewel from criticality ≥ 50
- `vw_server_technology_report` — grouped: by server_name with worst lifecycle status + next EOL date

---

## Key Design Decisions

1. **Crown jewel removed as stored boolean** — derived in views from portfolio_assignments.criticality >= 50. Prevents two sources of truth (system-computed vs human checkbox).

2. **management_classification + csdm_stage use CHECK constraints** — not reference tables. CSDM stages (0-4) are fixed ServiceNow standard. Saves reference tables for customer-configurable taxonomies.

3. **Contact roles NOT changed** — existing roles (business_owner, technical_owner, support) map cleanly to CSDM owned_by/managed_by/support_group via view aliases. Group architecture is Q2 concern.

4. **vendor_lifecycle_sources built now** — tracks data provenance for SOC2. Q2 AI refresh will use extraction_strategy + lifecycle_url.

5. **GENERATED ALWAYS removed** — PostgreSQL won't allow CURRENT_DATE in stored generated columns. Inline CASE in views is simpler and always current.

6. **Web Server confirmed as distinct category** — real customer data (740 servers) tracks IIS, Apache, Nginx, Tomcat, Domino as separate technology class.

---

## Database Changes Summary

| Object | Count | Details |
|--------|-------|---------|
| New tables | 2 | technology_lifecycle_reference, vendor_lifecycle_sources |
| Altered tables | 4 | applications, deployment_profiles, technology_products, deployment_profile_technology_products |
| New columns | 7 | management_classification, csdm_stage, branch, server_name, lifecycle_reference_id, edition, updated_at |
| New views | 4 | vw_technology_tag_lifecycle_risk, vw_technology_health_summary, vw_application_infrastructure_report, vw_server_technology_report |
| RLS policies added | 8 | 4 per new table |
| GRANTs added | 12 | 4 per new table + 4 view SELECTs |
| Audit triggers added | 4 | 2 new tables + 2 pre-existing gaps |
| updated_at triggers added | 3 | 2 new tables + 1 junction table |
| Indexes added | 10 | 6 on lifecycle_reference, 1 partial on server_name, 1 on lifecycle_reference_id, 1 on dp_server_name, 1 GIN search |
| Seed data | 76 lifecycle rows, 16 vendor sources, Web Server category ×17 namespaces |

---

## Final Stats (Post-Session)

| Metric | Value |
|--------|-------|
| Tables | 82 |
| RLS policies | 315 |
| Audit triggers | 29 |
| Views | 23 |
| Functions | 52 |

---

## Validation Results

| Check | Status |
|-------|--------|
| Section 2: New table checklist | ✅ PASS (after gap fix) |
| Section 3: Database validation | ✅ PASS — all 6 tables have RLS, policies, GRANTs, triggers |
| Section 4: Security posture | ✅ PASS — all 4 new views security_invoker=true |
| Section 9: Stats alignment | ⚠️ Memory needs update (82 tables, 29 triggers, 315 policies, 23 views) |

---

## Still Open

- **Schema backup needed** — Stuart to run pg_dump and commit
- **technology_products missing updated_at trigger** — pre-existing gap, not from this session. LOW priority.
- **Lifecycle date verification** — top 3 vendors verified (Microsoft, Oracle, Red Hat). Remaining 6 vendor URLs from architecture doc, verify in Q2.
- **No frontend changes** — schema only this session. UI for Technology Health Dashboard is Week 4-5 per Gantt.

---

## Context for Next Session

Technology Health Dashboard schema is fully deployed and validated. The four views are ready for the frontend to consume. Next steps:

1. **Schema backup** (pg_dump → git commit)
2. **UI development** — Claude Code / AG builds Technology Health Dashboard page using the 4 views
3. **Demo data** — tag some applications in City of Riverside with technology products + link to lifecycle references to see the views populate
4. **Week 4 Gantt alignment** — Tech Health Dashboard UI (Feb 24-28) is ahead of schedule

The lifecycle_reference_id FK on technology_products is the key link. When a user tags "SQL Server 2019" on a deployment profile, the frontend should also set the lifecycle_reference_id on the technology_product row to connect it to the lifecycle dates.

---

*Session: February 18, 2026*  
*Next: Technology Health Dashboard UI + demo data tagging*
